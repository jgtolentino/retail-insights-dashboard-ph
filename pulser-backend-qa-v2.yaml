name: backend-qa-v2
description: "Backend QA with proper pass/fail reporting"

tasks:
  backend-qa-proper:
    description: "Run backend QA tests with clear results"
    run: |
      echo "ğŸ§ª Backend QA Test Suite"
      echo "========================"
      
      # Initialize test results
      PASSED=0
      FAILED=0
      
      # Load environment
      if [ -f .env ]; then
        export $(cat .env | xargs)
      fi
      
      # Test 1: Database Connection
      echo -n "ğŸ“‹ Database Connection Test... "
      if node scripts/test-supabase-connection-simple.js > /tmp/test1.log 2>&1; then
        echo "âœ… PASS"
        ((PASSED++))
      else
        echo "âŒ FAIL"
        ((FAILED++))
      fi
      
      # Test 2: SQL Functions
      echo -n "ğŸ“‹ SQL Functions Test... "
      if node scripts/test-sql-functions.js > /tmp/test2.log 2>&1; then
        echo "âœ… PASS"
        ((PASSED++))
      else
        echo "âŒ FAIL"
        ((FAILED++))
      fi
      
      # Test 3: Unit Tests
      echo -n "ğŸ“‹ Unit Tests... "
      if npm run test:unit -- --run > /tmp/test3.log 2>&1; then
        echo "âœ… PASS"
        ((PASSED++))
      else
        echo "âŒ FAIL"
        ((FAILED++))
      fi
      
      # Test 4: Integration Tests
      echo -n "ğŸ“‹ Integration Tests... "
      if npm run test:integration -- --run > /tmp/test4.log 2>&1; then
        echo "âœ… PASS"
        ((PASSED++))
      else
        echo "âŒ FAIL"
        ((FAILED++))
      fi
      
      # Test 5: Filter Tests
      echo -n "ğŸ“‹ Filter Tests... "
      if node scripts/comprehensive-filter-test.js > /tmp/test5.log 2>&1; then
        echo "âœ… PASS"
        ((PASSED++))
      else
        echo "âŒ FAIL"
        ((FAILED++))
      fi
      
      # Summary
      echo ""
      echo "ğŸ“Š Test Summary"
      echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
      echo "Total: $((PASSED + FAILED))"
      echo "Passed: $PASSED âœ…"
      echo "Failed: $FAILED âŒ"
      
      if [ $FAILED -eq 0 ]; then
        echo ""
        echo "ğŸ‰ All tests passed!"
        exit 0
      else
        echo ""
        echo "âš ï¸  Some tests failed"
        exit 1
      fi